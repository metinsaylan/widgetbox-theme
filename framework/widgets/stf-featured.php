<?phpfunction widget_stfcarousel_register() {	function widget_stfcarousel_options() {		return array(			'Title' => '',			'Category Id' => "",			'Number of Posts' => 1,			'Order By' => "Rand"		);	}		function widget_stfcarousel($args) {		extract($args); 		$options = array_merge(widget_stfcarousel_options(), get_option('widget_stfcarousel'));		unset($options[0]); //returned by get_option(), but we don't need it				echo $before_widget;				if(strlen($options['Title'])>0){			echo $before_title. $options['Title'] . " " . $after_title;		}				$fquery = "numberposts=".$options['Number of Posts']."&category=".$options['Category Id']."&orderby=" . $options['Order By'];		echo "<!-- Featured Posts Query: " . $fquery . " -->";				// Translate yes/no values		if(count($options))		foreach($options as $k=>$v)			switch(strtolower(trim($v))) {			case 'yes': case 'true': case '1':			  $options[$k] = 1; break;			default:			  $options[$k] = 0; break;			}			// Going off record here		$temp_query = $wp_query;	?>					<ul id="featured-posts">				<?php				$featured_posts = get_posts($fquery);								foreach( $featured_posts as $post ) {?>								<li class="fpost">				<div class="fpost-thumbnail">					<?php echo get_the_post_thumbnail($post->ID, 'thumbnail'); ?>				</div>				<span class="fpost-title"><?php echo $post->post_title; ?></span>				<div class="fpost-content"><?php echo $post->post_excerpt; ?></div>				</li>								<?php } ?>			</ul>				<div class="clear"></div>		<?php		// Back to normal..		$wp_query = $temp_query;			echo $after_widget;	}		function widget_stfcarousel_control() {    // Each widget can store and retrieve its own options.    // Here we retrieve any options that may have been set by the user    // relying on widget defaults to fill the gaps.		if(($options = get_option('widget_stfcarousel')) === FALSE) $options = array();		$options = array_merge(widget_stfcarousel_options(), $options);		unset($options[0]); //returned by get_option(), but we don't need it		// If user is submitting custom option values for this widget		if ( $_POST['stfcarousel-submit'] ) {				// Remember to sanitize and format use input appropriately.		foreach($options as $key => $value)			if(array_key_exists('stfcarousel-'.sanitize($key), $_POST))			$options[$key] = strip_tags(stripslashes($_POST['stfcarousel-'.sanitize($key)]));				// Save changes		update_option('widget_stfcarousel', $options);    }    foreach($options as $key => $value): ?>      <p style="text-align:left"><label for="stfcarousel-<?=sanitize($key)?>"><?=$key?>: <input style="width: 200px;" id="stfcarousel-<?=sanitize($key)?>" name="stfcarousel-<?=sanitize($key)?>" type="text" value="<?=htmlspecialchars($value, ENT_QUOTES)?>" /></label></p>    <?php endforeach;    echo '<input type="hidden" id="stfcarousel-submit" name="stfcarousel-submit" value="1" />';  }  wp_register_sidebar_widget('', 'Featured Posts', 'widget_stfcarousel', widget_stfcarousel_options());  wp_register_widget_control('', 'Featured Posts', 'widget_stfcarousel_control', 220, 50 * count(widget_stfcarousel_options()));  }add_action('init', 'widget_stfcarousel_register');?>